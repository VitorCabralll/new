# üéØ PROPOSTA: Sistema de Agentes H√≠bridos (Conhecimento + Estilo)

**Data:** 04 de Outubro de 2025
**Conceito:** Combinar Agentes Especializados (mat√©ria) + Agentes Trein√°veis (estilo do usu√°rio)

---

## 1. CONCEITO: Dois Tipos de Agentes

### **AGENTE ESPECIALIZADO (Conhecimento Jur√≠dico)**

**O que √©:**
- Agente pr√©-configurado pela PLATAFORMA
- Expertise em uma mat√©ria jur√≠dica espec√≠fica
- **N√£o personaliz√°vel** pelo usu√°rio (mantido pela equipe)

**Responsabilidade:**
- ‚úÖ Conhecimento t√©cnico correto
- ‚úÖ Leis e artigos aplic√°veis
- ‚úÖ Procedimentos jur√≠dicos adequados
- ‚úÖ Jurisprud√™ncia relevante
- ‚úÖ Estrutura formal da mat√©ria

**Exemplo:**
```typescript
AGENTE_HABILITACAO_CREDITO = {
  name: 'Especialista em Habilita√ß√£o de Cr√©dito',
  expertise: `
    Voc√™ √© um EXPERT em HABILITA√á√ÉO DE CR√âDITO (Lei 11.101/2005).

    CONHECIMENTO OBRIGAT√ìRIO:
    - Lei 11.101/2005, arts. 9¬∫ a 17¬∫ (procedimento de habilita√ß√£o)
    - Art. 9¬∫: Prazo de 15 dias para credores se habilitarem
    - Art. 10¬∫: Documentos necess√°rios para comprova√ß√£o
    - Art. 11¬∫: Classifica√ß√£o dos cr√©ditos (art. 83)
    - Art. 83: Ordem de classifica√ß√£o (trabalhistas > garantidos > quirograf√°rios)

    PROCEDIMENTO:
    1. Identificar habilitante e cr√©dito pleiteado
    2. Verificar documenta√ß√£o probat√≥ria
    3. Analisar enquadramento na classifica√ß√£o do art. 83
    4. Verificar c√°lculos e valores
    5. Emitir parecer fundamentado

    LINGUAGEM T√âCNICA:
    - "Cuida-se de habilita√ß√£o de cr√©dito..."
    - "O habilitante apresentou..."
    - "Quanto √† classe do cr√©dito..."
    - "Nos termos do art. 83, III, da Lei 11.101/05..."

    ELEMENTOS OBRIGAT√ìRIOS:
    - Identifica√ß√£o do habilitante
    - Natureza do cr√©dito
    - Valor pleiteado (atualizado)
    - Documentos comprobat√≥rios
    - Classifica√ß√£o segundo art. 83
    - Fundamenta√ß√£o legal completa
    - Parecer conclusivo (favor√°vel/parcialmente/desfavor√°vel)
  `
}
```

---

### **AGENTE DO USU√ÅRIO (Estilo Personalizado)**

**O que √©:**
- Agente treinado COM EXEMPLOS do usu√°rio
- Captura estilo, formata√ß√£o e prefer√™ncias
- **Personaliz√°vel** (cada advogado/escrit√≥rio tem o seu)

**Responsabilidade:**
- ‚úÖ Formata√ß√£o espec√≠fica
- ‚úÖ Tom de voz caracter√≠stico
- ‚úÖ Estrutura de se√ß√µes preferida
- ‚úÖ Padr√µes de cita√ß√£o
- ‚úÖ Assinatura e cabe√ßalho

**Exemplo:**
```typescript
AGENTE_DR_JOAO = {
  name: 'Agente Dr. Jo√£o Silva',
  systemInstruction: `
    [Gerado automaticamente a partir de 3 exemplos enviados pelo usu√°rio]

    ESTILO IDENTIFICADO:
    - Tom formal e objetivo
    - Se√ß√µes: IDENTIFICA√á√ÉO ‚Üí AN√ÅLISE ‚Üí FUNDAMENTA√á√ÉO ‚Üí PARECER
    - Usa negrito em termos-chave (**MINIST√âRIO P√öBLICO**, **LEI**)
    - Cita√ß√µes sempre com n√∫mero completo: "Lei n¬∫ 11.101, de 9/2/2005"
    - Par√°grafos curtos (3-4 linhas)
    - Inicia sempre: "Cuida-se de manifesta√ß√£o nos autos..."

    CABE√áALHO PADR√ÉO:
    MINIST√âRIO P√öBLICO DO ESTADO DE MATO GROSSO
    Promotoria de Justi√ßa de [comarca]
    Autos n¬∫ [n√∫mero]

    ASSINATURA:
    Jo√£o Silva
    Promotor de Justi√ßa
    Matr√≠cula: 12345
  `
}
```

---

## 2. ARQUITETURA: Como Combinar os Dois?

### **OP√á√ÉO 1: System Instruction Composta** ‚≠ê RECOMENDADO

**Como funciona:**
```typescript
// Combinar instru√ß√µes dos dois agentes em um √∫nico prompt
const promptHibrido = `
  === CONHECIMENTO T√âCNICO (Agente Especializado) ===
  ${AGENTE_ESPECIALIZADO[tipoDocumento].expertise}

  === ESTILO E FORMATA√á√ÉO (Agente do Usu√°rio) ===
  ${agenteUsuario.systemInstruction}

  === IMPORTANTE ===
  - Use o CONHECIMENTO ESPECIALIZADO para garantir corre√ß√£o t√©cnica
  - Use o ESTILO DO USU√ÅRIO para formata√ß√£o, tom e estrutura
  - Combine ambos para criar manifesta√ß√£o tecnicamente correta E no estilo do usu√°rio

  === DOCUMENTO ===
  ${documentoExtraido}

  === INSTRU√á√ïES ===
  ${instrucoesUsuario}

  Gere a manifesta√ß√£o seguindo AMBAS as diretrizes acima.
`;
```

**Vantagens:**
- ‚úÖ Simples de implementar (1 chamada de API)
- ‚úÖ R√°pido (sem overhead)
- ‚úÖ Custo baixo (mesmas chamadas atuais)
- ‚úÖ IA combina naturalmente as duas instru√ß√µes

**Desvantagens:**
- ‚ùå Prompt pode ficar muito longo (mas Gemini suporta bem)
- ‚ùå Poss√≠vel conflito se instru√ß√µes forem contradit√≥rias

**Esfor√ßo:** ~2-3 dias

---

### **OP√á√ÉO 2: Pipeline de 2 Etapas**

**Como funciona:**
```typescript
// ETAPA 1: Agente especializado gera conte√∫do t√©cnico bruto
const conteudoTecnicoBruto = await gerarComAgenteEspecializado({
  agente: AGENTE_ESPECIALIZADO[tipoDocumento],
  documento: documentoExtraido,
  instrucoes: instrucoesUsuario
});

// Resultado: Manifesta√ß√£o tecnicamente correta mas gen√©rica
// "HABILITA√á√ÉO DE CR√âDITO
//  Habilitante: ABC LTDA
//  Cr√©dito: R$ 100.000,00 (quirograf√°rio)
//  Documentos: Notas fiscais anexas
//  Fundamenta√ß√£o: Lei 11.101/05, art. 83, VI
//  Parecer: Favor√°vel"

// ETAPA 2: Agente do usu√°rio reformata no estilo dele
const manifestacaoFinal = await formatarComAgenteUsuario({
  agente: agenteUsuario,
  conteudoBruto: conteudoTecnicoBruto,
  documentoOriginal: documentoExtraido
});

// Resultado: Mesma informa√ß√£o t√©cnica + estilo do usu√°rio
// "MINIST√âRIO P√öBLICO DO ESTADO DE MATO GROSSO
//  Promotoria de Justi√ßa de Cuiab√°
//
//  Cuida-se de manifesta√ß√£o nos autos de habilita√ß√£o de cr√©dito...
//  [formata√ß√£o do Dr. Jo√£o]"
```

**Vantagens:**
- ‚úÖ Separa√ß√£o clara de responsabilidades
- ‚úÖ F√°cil debugar (2 etapas distintas)
- ‚úÖ Pode reutilizar conte√∫do t√©cnico para diferentes estilos
- ‚úÖ Agente especializado pode ser chamado de forma independente

**Desvantagens:**
- ‚ùå Mais lento (2 chamadas de API)
- ‚ùå Mais caro (~2x custo)
- ‚ùå Poss√≠vel perda de contexto entre etapas

**Esfor√ßo:** ~1 semana

---

### **OP√á√ÉO 3: Prompt H√≠brido Estruturado** ‚≠ê‚≠ê MELHOR QUALIDADE

**Como funciona:**
```typescript
const promptEstruturado = `
  Voc√™ √© um assistente jur√≠dico que combina CONHECIMENTO ESPECIALIZADO + ESTILO PERSONALIZADO.

  ## PASSO 1: An√°lise T√©cnica (use Agente Especializado)
  ${AGENTE_ESPECIALIZADO[tipoDocumento].expertise}

  Analise o documento e identifique:
  - Habilitante e cr√©dito
  - Documenta√ß√£o apresentada
  - Classe do cr√©dito (art. 83)
  - Fundamenta√ß√£o legal aplic√°vel
  - Parecer t√©cnico

  ## PASSO 2: Formata√ß√£o (use Agente do Usu√°rio)
  ${agenteUsuario.systemInstruction}

  Formate a an√°lise acima seguindo:
  - Estrutura de se√ß√µes do usu√°rio
  - Tom de voz caracter√≠stico
  - Padr√µes de cita√ß√£o preferidos
  - Cabe√ßalho e assinatura padr√£o

  ## DOCUMENTO:
  ${documentoExtraido}

  ## INSTRU√á√ïES:
  ${instrucoesUsuario}

  ## SA√çDA ESPERADA:
  Manifesta√ß√£o que:
  1. √â tecnicamente CORRETA (conhecimento especializado)
  2. Est√° formatada no ESTILO DO USU√ÅRIO (formata√ß√£o personalizada)
  3. Combina naturalmente ambas as diretrizes

  Gere a manifesta√ß√£o:
`;
```

**Vantagens:**
- ‚úÖ Melhor de ambos os mundos
- ‚úÖ Prompt estruturado guia a IA step-by-step
- ‚úÖ 1 chamada de API (r√°pido e barato)
- ‚úÖ Qualidade superior (IA segue processo claro)

**Desvantagens:**
- ‚ùå Prompt mais complexo de manter
- ‚ùå Requer testes para validar se IA segue estrutura

**Esfor√ßo:** ~3-4 dias

---

## 3. IMPLEMENTA√á√ÉO RECOMENDADA

### **Escolha: OP√á√ÉO 3 (Prompt H√≠brido Estruturado)**

**Raz√µes:**
1. Melhor qualidade (processo step-by-step)
2. Custo e velocidade iguais ao atual (1 API call)
3. F√°cil de testar e iterar

---

## 4. ARQUITETURA DETALHADA

### **4.1 Estrutura de Arquivos**

```
backend/src/
‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ specialized/           ‚Üê NOVO
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ habilitacaoCredito.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processoFalimentar.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recuperacaoJudicial.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.ts
‚îÇ   ‚îî‚îÄ‚îÄ hybrid/                ‚Üê NOVO
‚îÇ       ‚îú‚îÄ‚îÄ promptBuilder.ts   (combina agentes)
‚îÇ       ‚îî‚îÄ‚îÄ types.ts
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ generate.ts            (modificar)
‚îî‚îÄ‚îÄ services/
    ‚îî‚îÄ‚îÄ ... (mant√©m atual)
```

### **4.2 C√≥digo dos Agentes Especializados**

```typescript
// agents/specialized/habilitacaoCredito.ts
export const AgenteHabilitacaoCredito = {
  id: 'habilitacao-credito',
  name: 'Especialista em Habilita√ß√£o de Cr√©dito',
  materias: ['Habilita√ß√£o de Cr√©dito', 'Fal√™ncia'],

  expertise: `
    Voc√™ √© um EXPERT em HABILITA√á√ÉO DE CR√âDITO no contexto de processos falimentares.

    === BASE LEGAL ===
    - Lei n¬∫ 11.101/2005 (Lei de Fal√™ncias e Recupera√ß√£o Judicial)
    - Arts. 9¬∫ a 17¬∫: Procedimento de habilita√ß√£o de cr√©ditos
    - Art. 83: Classifica√ß√£o dos cr√©ditos

    === CONHECIMENTO T√âCNICO ===

    1. TIPOS DE HABILITA√á√ÉO:
       a) Habilita√ß√£o Ordin√°ria (art. 9¬∫):
          - Prazo: 15 dias contados da publica√ß√£o do edital
          - Procedimento: Apresenta√ß√£o de documentos comprobat√≥rios

       b) Habilita√ß√£o Retardat√°ria (art. 10¬∫):
          - Ap√≥s prazo do art. 9¬∫
          - Custas processuais por conta do habilitante

       c) Habilita√ß√£o de Cr√©ditos Il√≠quidos (art. 9¬∫, ¬ß2¬∫):
          - Estimativa do valor para reserva
          - Liquida√ß√£o posterior

    2. CLASSIFICA√á√ÉO DOS CR√âDITOS (art. 83):
       I - Cr√©ditos derivados da legisla√ß√£o trabalhista (at√© 150 s.m.)
       II - Cr√©ditos com garantia real (at√© o limite do bem)
       III - Cr√©ditos tribut√°rios
       IV - Cr√©ditos com privil√©gio especial
       V - Cr√©ditos com privil√©gio geral
       VI - Cr√©ditos quirograf√°rios
       VII - Multas contratuais e penas pecuni√°rias
       VIII - Cr√©ditos subordinados

    3. DOCUMENTA√á√ÉO NECESS√ÅRIA:
       - T√≠tulo executivo ou documento comprobat√≥rio
       - Demonstrativo de c√°lculo (se aplic√°vel)
       - Comprovante de origem do cr√©dito
       - Certid√µes e documentos complementares

    4. AN√ÅLISE DO MINIST√âRIO P√öBLICO:
       - Verificar legitimidade do habilitante
       - Analisar sufici√™ncia da documenta√ß√£o
       - Conferir c√°lculos apresentados
       - Verificar enquadramento na classifica√ß√£o
       - Emitir parecer fundamentado

    === ESTRUTURA DA MANIFESTA√á√ÉO ===

    1. IDENTIFICA√á√ÉO:
       - Processo
       - Habilitante
       - Valor do cr√©dito
       - Classe pretendida

    2. AN√ÅLISE DOS FATOS:
       - Documentos apresentados
       - Origem do cr√©dito
       - Per√≠odo de constitui√ß√£o

    3. FUNDAMENTA√á√ÉO JUR√çDICA:
       - Dispositivos legais aplic√°veis
       - Classifica√ß√£o segundo art. 83
       - Jurisprud√™ncia relevante (se aplic√°vel)

    4. PARECER MINISTERIAL:
       - Favor√°vel
       - Parcialmente favor√°vel (com ressalvas)
       - Desfavor√°vel
       - Fundamenta√ß√£o da conclus√£o

    === LINGUAGEM T√âCNICA OBRIGAT√ìRIA ===
    - "Cuida-se de habilita√ß√£o de cr√©dito..."
    - "O habilitante pretende habilitar..."
    - "Quanto √† classe do cr√©dito..."
    - "A documenta√ß√£o apresentada demonstra..."
    - "Nos termos do art. 83, [inciso], da Lei 11.101/05..."
    - "Pelo exposto, manifesta-se o MINIST√âRIO P√öBLICO..."

    === CRIT√âRIOS DE AN√ÅLISE ===

    ‚úì Verificar:
    - Tempestividade (prazo do art. 9¬∫?)
    - Legitimidade (habilitante √© credor?)
    - Documenta√ß√£o suficiente?
    - C√°lculo correto?
    - Classifica√ß√£o adequada?

    ‚úó Aten√ß√£o:
    - Cr√©ditos prescritos
    - Documenta√ß√£o insuficiente
    - Classifica√ß√£o inadequada
    - Valores excessivos ou infundados

    === IMPORTANTE ===
    - SEMPRE citar dispositivos legais COMPLETOS
    - SEMPRE fundamentar o parecer
    - SEMPRE verificar a classe do cr√©dito
    - NUNCA aceitar habilita√ß√£o sem comprova√ß√£o
  `,

  promptTemplate: (documentAnalysis: any, instructions: string) => `
    **AN√ÅLISE T√âCNICA (Especialista em Habilita√ß√£o de Cr√©dito):**

    Com base no documento, identifique:
    1. Habilitante e valor do cr√©dito pleiteado
    2. Documentos apresentados como comprova√ß√£o
    3. Classifica√ß√£o pretendida (art. 83)
    4. Verifica√ß√£o de requisitos legais (tempestividade, legitimidade, documenta√ß√£o)
    5. Parecer fundamentado (favor√°vel/parcialmente/desfavor√°vel)

    **Contexto do documento:**
    - Tipo: ${documentAnalysis.type}
    - Partes: ${documentAnalysis.parties}
    - Valores: ${documentAnalysis.values}
    - Datas: ${documentAnalysis.dates}

    **Instru√ß√µes adicionais:**
    ${instructions}
  `
};

// Exportar todos os agentes
export const AGENTES_ESPECIALIZADOS = {
  'Habilita√ß√£o de Cr√©dito': AgenteHabilitacaoCredito,
  'Processo Falimentar': AgenteProcessoFalimentar,
  'Recupera√ß√£o Judicial': AgenteRecuperacaoJudicial
};
```

### **4.3 Hybrid Prompt Builder**

```typescript
// agents/hybrid/promptBuilder.ts
import { AGENTES_ESPECIALIZADOS } from '../specialized';

export class HybridPromptBuilder {
  /**
   * Combina agente especializado + agente do usu√°rio
   */
  buildHybridPrompt(params: {
    documentType: string;
    userAgent: any;
    documentAnalysis: any;
    extractedText: string;
    instructions: string;
    contextSummary: string;
  }): string {
    // Selecionar agente especializado baseado no tipo de documento
    const specializedAgent = AGENTES_ESPECIALIZADOS[params.documentType];

    if (!specializedAgent) {
      // Fallback: usar apenas agente do usu√°rio
      return this.buildUserOnlyPrompt(params);
    }

    // Construir prompt h√≠brido estruturado
    return `
Voc√™ √© um assistente jur√≠dico especializado que combina CONHECIMENTO T√âCNICO + ESTILO PERSONALIZADO.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PARTE 1: CONHECIMENTO T√âCNICO ESPECIALIZADO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${specializedAgent.expertise}

${specializedAgent.promptTemplate(params.documentAnalysis, params.instructions)}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PARTE 2: ESTILO E FORMATA√á√ÉO DO USU√ÅRIO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${params.userAgent.systemInstruction}

**Importante sobre formata√ß√£o:**
- Use EXATAMENTE a estrutura de se√ß√µes definida acima
- Mantenha o tom de voz caracter√≠stico
- Siga os padr√µes de cita√ß√£o preferidos
- Inclua cabe√ßalho e assinatura conforme modelo

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PARTE 3: CONTEXTO DO DOCUMENTO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**Resumo:** ${params.contextSummary}

**Detalhes:**
- Tipo: ${params.documentAnalysis.type}
- Partes: ${params.documentAnalysis.parties}
- Valores: ${params.documentAnalysis.values}
- Datas: ${params.documentAnalysis.dates}

**Documento completo:**
${params.extractedText}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PARTE 4: INSTRU√á√ïES ESPEC√çFICAS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${params.instructions}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
TAREFA: GERAR MANIFESTA√á√ÉO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Siga este processo:

PASSO 1: AN√ÅLISE T√âCNICA
- Use o conhecimento especializado da PARTE 1
- Identifique todos os elementos t√©cnicos necess√°rios
- Verifique requisitos legais aplic√°veis
- Formule parecer fundamentado

PASSO 2: ESTRUTURA√á√ÉO
- Organize o conte√∫do t√©cnico na estrutura do usu√°rio (PARTE 2)
- Mantenha todas as informa√ß√µes t√©cnicas
- Adapte o tom de voz

PASSO 3: FORMATA√á√ÉO FINAL
- Aplique formata√ß√£o preferida do usu√°rio
- Inclua cabe√ßalho e assinatura padr√£o
- Verifique se todos os elementos obrigat√≥rios est√£o presentes

RESULTADO ESPERADO:
Manifesta√ß√£o que √©:
‚úì Tecnicamente CORRETA (conhecimento especializado)
‚úì Formatada no ESTILO DO USU√ÅRIO (prefer√™ncias pessoais)
‚úì Completa e bem fundamentada
‚úì Pronta para uso profissional

Gere a manifesta√ß√£o agora:
    `.trim();
  }

  /**
   * Fallback: apenas agente do usu√°rio (sem especializado)
   */
  private buildUserOnlyPrompt(params: any): string {
    return `
**SISTEMA:** ${params.userAgent.systemInstruction}

**CONTEXTO GLOBAL:** ${params.contextSummary}

**CONTEXTO DO CASO:**
- Tipo de documento: ${params.documentAnalysis.type}
- Partes identificadas: ${params.documentAnalysis.parties}
- Valores mencionados: ${params.documentAnalysis.values}
- Data de refer√™ncia: ${params.documentAnalysis.dates}

**INSTRU√á√ïES ESPEC√çFICAS:** ${params.instructions}

**DOCUMENTO PARA AN√ÅLISE:**
${params.extractedText}

**FORMATO OBRIGAT√ìRIO:**
- Use EXATAMENTE a estrutura definida na instru√ß√£o do sistema
- Inclua TODOS os cabe√ßalhos e formata√ß√µes especificados
- Mencione IDs de documentos quando relevante
- Finalize com assinatura eletr√¥nica padr√£o

Gere a manifesta√ß√£o:
    `.trim();
  }
}

export const hybridPromptBuilder = new HybridPromptBuilder();
```

### **4.4 Integra√ß√£o no Pipeline**

```typescript
// routes/generate.ts (modificar fun√ß√£o createPrompt)

import { hybridPromptBuilder } from '../agents/hybrid/promptBuilder.js';

// ANTES:
function createPrompt(agent, documentAnalysis, instructions, content, contextSummary) {
  return `
    **SISTEMA:** ${agent.systemInstruction}
    **CONTEXTO GLOBAL:** ${contextSummary}
    ...
  `;
}

// DEPOIS:
function createPrompt(agent, documentAnalysis, instructions, content, contextSummary) {
  // Usar Hybrid Prompt Builder
  return hybridPromptBuilder.buildHybridPrompt({
    documentType: documentAnalysis.type,
    userAgent: agent,
    documentAnalysis,
    extractedText: content,
    instructions,
    contextSummary
  });
}
```

---

## 5. EXEMPLO COMPLETO

### **Entrada:**

**Documento:** Habilita√ß√£o de cr√©dito da empresa ABC LTDA

**Agente do Usu√°rio (Dr. Jo√£o):**
```
- Tom formal e objetivo
- Estrutura: IDENTIFICA√á√ÉO ‚Üí AN√ÅLISE ‚Üí FUNDAMENTA√á√ÉO ‚Üí PARECER
- Cita√ß√µes completas: "Lei n¬∫ 11.101, de 9 de fevereiro de 2005"
- Inicia: "Cuida-se de manifesta√ß√£o nos autos..."
```

**Instru√ß√µes:** "Analisar a habilita√ß√£o e emitir parecer sobre a documenta√ß√£o apresentada"

### **Sa√≠da (Manifesta√ß√£o Gerada):**

```
MINIST√âRIO P√öBLICO DO ESTADO DE MATO GROSSO
Promotoria de Justi√ßa de Cuiab√°
Autos n¬∫ 1234567-89.2025.8.11.0001

MANIFESTA√á√ÉO

Cuida-se de manifesta√ß√£o nos autos de **HABILITA√á√ÉO DE CR√âDITO** apresentada por **ABC COM√âRCIO LTDA** no processo de fal√™ncia da empresa XYZ IND√öSTRIA S/A.

=== IDENTIFICA√á√ÉO ===

**Habilitante:** ABC COM√âRCIO LTDA (CNPJ 12.345.678/0001-90)
**Valor pleiteado:** R$ 150.000,00 (cento e cinquenta mil reais)
**Classe pretendida:** Quirograf√°rio (art. 83, VI, da Lei 11.101/05)
**Documenta√ß√£o:** Notas fiscais n¬∫ 001 a 015, contratos de fornecimento

=== AN√ÅLISE DOS FATOS ===

O habilitante apresentou documenta√ß√£o comprobat√≥ria consistente em **15 (quinze) notas fiscais** emitidas entre janeiro e mar√ßo de 2024, referentes ao fornecimento de mercadorias √† recuperanda, devidamente acompanhadas dos respectivos comprovantes de entrega.

Os documentos demonstram a **origem do cr√©dito** (fornecimento de mercadorias), o **per√≠odo de constitui√ß√£o** (janeiro a mar√ßo/2024) e o **valor total** de R$ 150.000,00.

=== FUNDAMENTA√á√ÉO JUR√çDICA ===

Nos termos do **art. 9¬∫ da Lei n¬∫ 11.101, de 9 de fevereiro de 2005**, a habilita√ß√£o de cr√©ditos deve ser apresentada no prazo de 15 dias contados da publica√ß√£o do edital, acompanhada dos documentos comprobat√≥rios.

Quanto √† classifica√ß√£o, o cr√©dito pleiteado enquadra-se como **quirograf√°rio** (art. 83, VI, da Lei 11.101/05), uma vez que n√£o se trata de cr√©dito trabalhista, com garantia real, tribut√°rio ou com qualquer privil√©gio.

A documenta√ß√£o apresentada atende aos requisitos do **art. 9¬∫, ¬ß1¬∫**, demonstrando de forma satisfat√≥ria a origem e o valor do cr√©dito.

=== PARECER MINISTERIAL ===

Pelo exposto, manifesta-se o **MINIST√âRIO P√öBLICO** **FAVORAVELMENTE** √† habilita√ß√£o do cr√©dito de R$ 150.000,00 (cento e cinquenta mil reais) em favor de ABC COM√âRCIO LTDA, na classe de cr√©ditos quirograf√°rios (art. 83, VI, da Lei 11.101/05).

Cuiab√°/MT, 4 de outubro de 2025.

**Jo√£o Silva**
Promotor de Justi√ßa
Matr√≠cula: 12345
```

### **An√°lise da Sa√≠da:**

‚úÖ **Conhecimento t√©cnico correto:**
- Lei 11.101/2005 citada corretamente
- Arts. 9¬∫ e 83 aplicados adequadamente
- Classifica√ß√£o como quirograf√°rio justificada
- Procedimento de habilita√ß√£o seguido

‚úÖ **Estilo do Dr. Jo√£o preservado:**
- Estrutura: IDENTIFICA√á√ÉO ‚Üí AN√ÅLISE ‚Üí FUNDAMENTA√á√ÉO ‚Üí PARECER
- Tom formal e objetivo
- Cita√ß√µes completas: "Lei n¬∫ 11.101, de 9 de fevereiro de 2005"
- Inicia: "Cuida-se de manifesta√ß√£o nos autos..."
- Cabe√ßalho e assinatura padr√£o

‚úÖ **Combina√ß√£o perfeita:**
- Tecnicamente correta
- Formatada no estilo do usu√°rio
- Pronta para uso profissional

---

## 6. BENEF√çCIOS DO SISTEMA H√çBRIDO

### **Para o Usu√°rio:**

‚úÖ **Qualidade consistente:** Conhecimento t√©cnico sempre correto
‚úÖ **Personaliza√ß√£o:** Mant√©m estilo pr√≥prio
‚úÖ **Confian√ßa:** Sabe que aspectos t√©cnicos est√£o cobertos
‚úÖ **Produtividade:** Menos revis√µes necess√°rias

### **Para a Plataforma:**

‚úÖ **Escalabilidade:** Novos agentes especializados beneficiam todos os usu√°rios
‚úÖ **Manutenibilidade:** Agentes especializados mantidos centralmente
‚úÖ **Qualidade:** Garantia de corre√ß√£o t√©cnica
‚úÖ **Diferencial:** Combina√ß√£o √∫nica no mercado

### **M√©tricas Esperadas:**

- **Qualidade t√©cnica:** 9.2 ‚Üí **9.7** (conhecimento especializado)
- **Satisfa√ß√£o:** Alta (estilo preservado + corre√ß√£o t√©cnica)
- **Taxa de edi√ß√£o manual:** 30% ‚Üí **10%** (menos corre√ß√µes necess√°rias)
- **Confian√ßa do usu√°rio:** **+40%** (seguran√ßa t√©cnica)

---

## 7. ROADMAP DE IMPLEMENTA√á√ÉO

### **Fase 1: Prot√≥tipo (1 semana)**

**Dia 1-2:**
- ‚úÖ Criar estrutura de diret√≥rios (`agents/specialized`, `agents/hybrid`)
- ‚úÖ Implementar AgenteHabilitacaoCredito completo
- ‚úÖ Criar HybridPromptBuilder

**Dia 3-4:**
- ‚úÖ Integrar no pipeline (`generate.ts`)
- ‚úÖ Testes com documentos reais de habilita√ß√£o
- ‚úÖ Ajustes no prompt especializado

**Dia 5:**
- ‚úÖ Deploy em staging
- ‚úÖ Testes com usu√°rios beta
- ‚úÖ Coleta de feedback

### **Fase 2: Expans√£o (2 semanas)**

**Semana 1:**
- ‚úÖ Implementar AgenteProcessoFalimentar
- ‚úÖ Implementar AgenteRecuperacaoJudicial
- ‚úÖ Testes com m√∫ltiplos tipos de documento

**Semana 2:**
- ‚úÖ Refinamento dos prompts especializados
- ‚úÖ Sistema de sele√ß√£o autom√°tica de agente
- ‚úÖ Dashboard para monitorar qual agente est√° sendo usado

### **Fase 3: Produ√ß√£o (1 semana)**

- ‚úÖ Deploy gradual em produ√ß√£o
- ‚úÖ Monitoramento de m√©tricas
- ‚úÖ Ajustes baseados em dados reais
- ‚úÖ Documenta√ß√£o completa

---

## 8. PR√ìXIMOS PASSOS

### **Decis√£o Necess√°ria:**

1. ‚úÖ **Aprovar arquitetura h√≠brida** (Agentes Especializados + Usu√°rio)?
2. ‚úÖ **Confirmar OP√á√ÉO 3** (Prompt H√≠brido Estruturado)?
3. ‚úÖ **Autorizar in√≠cio da implementa√ß√£o**?

### **Se aprovado, come√ßar:**

1. Criar `agents/specialized/habilitacaoCredito.ts`
2. Criar `agents/hybrid/promptBuilder.ts`
3. Modificar `routes/generate.ts` (fun√ß√£o `createPrompt`)
4. Testar com documentos reais
5. Iterar baseado em resultados

**Pergunta:** Posso come√ßar a implementar agora?
